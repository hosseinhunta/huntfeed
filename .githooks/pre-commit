#!/bin/bash
# Pre-commit hook to prevent committing sensitive files

echo "üîç Checking for sensitive files..."

# Check for .env file (except .env.example)
if [ -f ".env" ]; then
    echo "‚ùå ERROR: .env file found - this should not be committed!"
    echo "   Add .env to .gitignore if not already there"
    exit 1
fi

# Check for credential files
SENSITIVE_FILES=".env .env.local secrets.php config/secrets.php credentials.json"
for file in $SENSITIVE_FILES; do
    if [ -f "$file" ]; then
        echo "‚ùå ERROR: Sensitive file found: $file"
        exit 1
    fi
done

# Check for common patterns that might indicate secrets
if grep -r "password.*=.*['\"]" src/ --include="*.php" 2>/dev/null | grep -v "^Binary"; then
    echo "‚ö†Ô∏è  WARNING: Found potential password in code"
fi

if grep -r "api.key\|apiKey\|api_key" src/ --include="*.php" 2>/dev/null | grep -v "^Binary"; then
    echo "‚ö†Ô∏è  WARNING: Found potential API key reference"
fi

# Check for vendor directory
if [ -d "vendor" ]; then
    echo "‚ÑπÔ∏è  Vendor directory found - this should be in .gitignore"
fi

# Check for logs directory
if [ -d "logs" ] && [ "$(ls -A logs 2>/dev/null)" ]; then
    echo "‚ÑπÔ∏è  Logs directory has files - should be in .gitignore"
fi

echo "‚úÖ Security check passed!"
exit 0
